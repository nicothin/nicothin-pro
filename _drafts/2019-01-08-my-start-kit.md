---
layout:     post
title:      "Мой стартовый репозиторий"
subtitle:   "Для проектов по вёрстке"
permalink:  /page/:title
categories: web
---

В моей практике по-прежнему встречаются проекты, требующие на выходе самый обычный набор html, css, js, картинок и прочих доп. файлов, поэтому недавно я обновил свой стартовый репозиторий для таких проектов аж до 4-й версии. Главное нововведение 4-й версии: автоматика самостоятельно определяет используемые блоки и берёт их в сборку.


## Что это такое

Это [репозиторий на github](https://github.com/nicothin/NTH-start-project), с клонирования которого я начинаю каждый проект по вёрстке. Внутри [методология БЭМ](https://ru.bem.info/methodology/), [pug](https://pugjs.org/api/getting-started.html) и [SCSS](https://sass-lang.com/). Автоматизация сделана с gulp и webpack.

Собственно, это простая система сборки проекта, в котором хочется компонентного подхода, но без js-фреймворков.

Порог вхождения низкий: установленный [Node.js](https://nodejs.org/en/), [базовый навык](/page/console-windows) работы с терминалом.


## Главные фишки

**Привычное работающее окружение**. Приятно начинать проект с набором хорошо знакомых инструментов.

**Разделение на блоки**. Примерно как в полном стеке БЭМ-а: все файлы блока хранятся в папке блока: папка `src/blocks/main-nav` содержит все файлы, нужные для вывода главной навигации.

**В сборку автоматически попадут только используемые блоки**. Если БЭМ-блок упомянут в разметке страницы или указан как безусловно нужный в `config.js`, его разметочный, стилевой и скриптовой файлы попадут в сборку, если существуют. Если блок перестаёт использоваться в разметке страницы, из сборки **автоматически** пропадает всё, что его касается.

**Библиотека готовых компонентов** с минимальной стилизацией. Один раз написал разметку и базовые стили повторяющихся элементов (кнопки, поля форм, главная навигация, «шапка», «подвал» и т.п.) и использую их, добавляя нужные проекту стили. Библиотека блоков имеет [веб-представление](https://nicothin.pro/NTH-start-project/blocks-demo.html), служащее и её документацией.

**Команда быстрого создания файловой структуры блока**. `node createBlock.js new-block pug js` — создаст `src/blocks/new-block`, две пустые подпапки для изображений, scss-, pug- и js-файлы со стартовым содержимым. Если не указать в конце команды доп. расширения `pug` и `js`, соотв. файлы не будут созданы.


## Как это работает

Описание работы есть в [репозитории](https://github.com/nicothin/NTH-start-project). На момент написания этого текста после запуска сервера разработки (`npm start`) происходит следующее:

1. Очищается папка сборки (`build/`).
5. Записывается файл `src/pug/mixins.pug` со всеми pug-файлами блоков.
5. Компилируются файлы страниц (`src/pages/**/*.pug`).
5. Из скомпилированных html-файлов извлекаются все классы уровня БЭМ-блока. На основании этого списка будут построены диспетчер подключения стилей и список всех js-файлов проекта.
5. Генерируются спрайты, в папку сборки копируются картинки блоков и доп. файлы из секции `addAssets` файла `config.js`.
5. Записывается диспетчер подключения стилей `src/scss/style.scss`, в котором:
    - Импорты файлов из секции `addStyleBefore` файла `config.js`. По умолчанию — SCSS-переменные и примеси.
    - Импорты файлов БЭМ-блоков, использующихся на проекте.
    - Импорты файлов БЭМ-блоков, упомянутых в секции `alwaysAddBlocks` файла `config.js`. Таким образом, можно взять в сборку любой блок, даже если его css-класс не упоминается в разметке страниц.
    - Импорты файлов из секции `addStyleAfter` файла `config.js`. По умолчанию — стили для печати страницы.
5. Записывается диспетчер подключений скриптов `src/js/entry.js`, в котором:
    - `require` файлов из секции `addJsBefore` файла `config.js`.
    - `require` файлов БЭМ-блоков, использующихся на проекте.
    - `require` файлов БЭМ-блоков, упомянутых в секции `alwaysAddBlocks` файла `config.js`.
    - `require` файлов из секции `addJsAfter` файла `config.js`.
5. Компилируются и обрабатываются PostCSS-ом стили (`src/scss/style.scss`).
6. Javascript (`src/js/entry.js`) собирается webpack-ом.
5. Запускается локальный сервер и слежение за файлами для пересборки.

При изменениях в разметке, стилях и скриптах происходит пересборка и автообновление страницы в браузере (в случае стилей — без перезагрузки страницы).


## Как я с этим работаю

Клонирую репозиторий, захожу в папку проекта, удаляю папку `.git`, инициирую новый репозиторий, привязываю удалённый репозиторий, устанавливаю зависимости.

Запускаю сервер разработки (для команды `npm start` у меня есть алиас `s`).

Редактирую шаблон(ы) страниц (`src/pug`), если нужно. Сколько на проекте типов раскладок блоков по странице, столько, обычно, бывает и pug-шаблонов страниц.

Пишу разметку страниц, используя готовые pug-примеси из [библиотеки](https://nicothin.pro/NTH-start-project/blocks-demo.html) и добавляя нужные проекту блоки командой `node createBlock.js ИМЯБЛОКА` (при этом можно не останавливать сервер). Для неповторяющихся структурных блоков часто не создаю pug-примесей, пишу их разметку напрямую в файлах страниц.

Определяю SCSS-переменные, стилизую базовую типографику, стилизую блоки библиотеки до проектного вида. Параллельно стилизую специфические блоки проекта.

Если нужно взять в сборку блоки, классы которых не упоминаются в разметке (скажем, `sprite-png`, собирающий растровый спрайт), останавливаю сервер и упоминаю нужные блоки в секции `alwaysAddBlocks` файла `config.js`. Нужны какие-либо дополнительные файлы (шрифты, фавиконки...) — упоминаю их в том же `config.js`.

